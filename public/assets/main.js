!function(){function e(e){if("Abs."===e)return 0;if(!e||""===e.trim())return null;const t=parseFloat(e.replace(",","."));return isNaN(t)?null:t}function t(e){return e.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}function n(e,n){const o={semester1:{},semester2:{}},a=n.find((t=>t.year===e));if(!a)return console.debug(`No year entry found for ${e}`),null;const r=document.getElementById(a.contentId);if(!r)return console.debug(`No content div found for ID ${a.contentId}`),null;const s=r.querySelectorAll('table[role="grid"]');return s.length?(s.forEach(((e,n)=>{const a=e.querySelectorAll("thead th"),r={};a.forEach(((e,n)=>{const o=e.querySelector(".ui-column-title")?.textContent;if(o){const e=t(o),a={"UNITE/MATIERE":"Unit√©/Mati√®re","COEF.":"Coef.",DEVOIR:"DEVOIR","TRAVAUX PRATIQUES":"TRAVAUX PRATIQUES",EXAMEN:"EXAMEN",PROJET:"PROJET","EXAMEN RATTRAPAGE":"EXAMEN RATTRAPAGE"};Object.entries(a).forEach((([t,o])=>{e===t&&(r[o]=n)}))}}));const s=["DEVOIR","TRAVAUX PRATIQUES","EXAMEN","PROJET","EXAMEN RATTRAPAGE"].some((e=>e in r)),l="Unit√©/Mati√®re"in r&&"Coef."in r;if(!s||!l)return void console.debug(`Table ${n} skipped: hasGradeColumns=${s}, hasRequiredColumns=${l}`);const d=e.querySelectorAll("tbody tr");let i="",c=0,p="";d.forEach(((e,n)=>{if(e.classList.contains("ui-rowgroup-header")){const a=e.querySelectorAll("td");if(a.length>=2){const e=a[0].textContent.trim();if(c=parseFloat(a[1].textContent.trim().replace(",","."))||1,t(e).includes("SEMESTRE 1"))p="semester1";else{if(!t(e).includes("SEMESTRE 2"))return void console.debug(`Row ${n} skipped: No semester specified in module name "${e}"`);p="semester2"}i=e.replace(/\/semestre [1-2]/i,"").trim(),o[p][i]||(o[p][i]={coefficient:c,subjects:{}})}}else if(p){const t=e.querySelectorAll('td[role="gridcell"]');if(t.length>=3){const e=t[r["Unit√©/Mati√®re"]].textContent.trim(),n=parseFloat(t[r["Coef."]].textContent.trim().replace(",","."))||1,a=r.DEVOIR?t[r.DEVOIR].textContent.trim():"",s=r["TRAVAUX PRATIQUES"]?t[r["TRAVAUX PRATIQUES"]].textContent.trim():"",l=r.EXAMEN?t[r.EXAMEN].textContent.trim():"",d=r.PROJET?t[r.PROJET].textContent.trim():"",c=r["EXAMEN RATTRAPAGE"]?t[r["EXAMEN RATTRAPAGE"]].textContent.trim():"";o[p][i].subjects[e]={coefficient:n,devoir:a,tp:s,exam:l,projet:d,examRattrapage:c}}else console.debug(`Row ${n} skipped: Insufficient cells (${t.length})`)}}))})),0===Object.keys(o.semester1).length&&delete o.semester1,0===Object.keys(o.semester2).length&&delete o.semester2,0===Object.keys(o).length?(console.debug(`No grades extracted for ${e}`),null):o):(console.debug(`No tables found in content div ${a.contentId}`),null)}function o(t){let n=0,o=0;const a=[];Object.entries(t.subjects).forEach((([t,r])=>{const s=function(t,n,o,a,r){const s=e(t),l=e(o),d=e(a),i=e(n),c=e(r),p=null!==s,u=null!==l,m=null!==d,f=null!==i,h=null!==c?Math.max(l||0,c):l;let g=0,E="",C=0,x="";m?(C=d,x="PROJET"):f?(C=i,x="TP"):(C=null,x="TP/PROJET");const b=null!==C;return u&&p&&b?(g=.5*h+.3*s+.2*C,E=`Exam(${h})√ó0.5 + Devoir(${s})√ó0.3 + ${x}(${C})√ó0.2`):u&&p?(g=.6*h+.4*s,E=`Exam(${h})√ó0.6 + Devoir(${s})√ó0.4`):u&&b?(g=.6*h+.4*C,E=`Exam(${h})√ó0.6 + ${x}(${C})√ó0.4`):b?(g=C,E=`${x}(${C})√ó1.0`):p?(g=s,E=`Devoir(${s})√ó1.0`):u?(g=h,E=`Exam(${h})√ó1.0`):(g=0,E=`All components absent or not applicable (Exam(${h||0}) + Devoir(${s||0}) + ${x}(${C||0}))`),{grade:Math.round(100*g)/100,calculation:E}}(r.devoir,r.tp,r.exam,r.projet,r.examRattrapage);n+=s.grade*r.coefficient,o+=r.coefficient,a.push({name:t,grade:s.grade,coefficient:r.coefficient,calculation:s.calculation,status:s.grade>=8?"pass":"fail"})}));const r=o>0?n/o:0;return{average:Math.round(100*r)/100,subjects:a,totalCoef:o,status:r>=8?"pass":"fail"}}function a(e,t){const n=(e,t={})=>{const n=document.createElement(e);return t.text&&(n.textContent=t.text),t.html&&(n.innerHTML=t.html),t.className&&(n.className=t.className),t.attrs&&Object.entries(t.attrs).forEach((([e,t])=>n.setAttribute(e,t))),n};if(!t||0===Object.keys(t.semester1||{}).length&&0===Object.keys(t.semester2||{}).length)return n("p",{text:`‚ùå No grades data found for ${e} or no grade tables detected.`});const a=n("div"),r=n("p",{html:`üéØ <strong>Calculating grades for ${e}...</strong>`});a.appendChild(r);const s={semester1:[],semester2:[]};let l=0,d=0;const i=[];["semester1","semester2"].forEach((e=>{if(!t[e]||0===Object.keys(t[e]).length)return;const r=n("section"),c=n("h2",{text:"Semester "+("semester1"===e?"1":"2")});r.appendChild(c);let p=0,u=0;Object.entries(t[e]).forEach((([t,a])=>{const l=n("section"),d=n("h2",{text:`Module: ${t} (Coef: ${a.coefficient})`});l.appendChild(d);const c=n("table"),m=n("thead"),f=n("tr");["Subject","Coef","Grade","Status","Calculation"].forEach((e=>{f.appendChild(n("th",{text:e}))})),m.appendChild(f),c.appendChild(m);const h=n("tbody"),g=o(a),E=[];g.subjects.forEach((e=>{const t=n("tr");t.appendChild(n("td",{text:e.name})),t.appendChild(n("td",{text:e.coefficient.toString()})),t.appendChild(n("td",{text:e.grade.toFixed(2)}));const o=n("td",{text:"pass"===e.status?"‚úÖ PASS":"‚ùå FAIL",className:"pass"===e.status?"pass":"fail"});t.appendChild(o);const a=n("td"),r=n("div",{text:e.calculation,className:"calculation"});a.appendChild(r),t.appendChild(a),h.appendChild(t),e.grade<8&&E.push(e.name)})),c.appendChild(h),l.appendChild(c);const C=n("p",{html:`<strong>Module Average: </strong><span class="${g.status}">${g.average.toFixed(2)}/20 ‚Äî ${"pass"===g.status?"‚úÖ PASS":"‚ùå FAIL"}</span>`});l.appendChild(C),r.appendChild(l),s[e].push({name:t,average:g.average,coefficient:a.coefficient,status:g.status,subjectsBelow8:E}),g.average<8&&i.push({moduleName:t,semester:"semester1"===e?"Semester 1":"Semester 2",subjectsBelow8:E}),p+=g.average*a.coefficient,u+=a.coefficient}));const m=u>0?Math.round(p/u*100)/100:0,f=m>=8?"pass":"fail",h=n("summary",{html:`<strong>Semester Average: </strong><span class="${f}">${m.toFixed(2)}/20 ‚Äî ${"pass"===f?"‚úÖ PASS":"‚ùå FAIL"}</span>`});r.appendChild(h),a.appendChild(r),l+=p,d+=u}));const c=d>0?Math.round(l/d*100)/100:0;let p="fail",u="";const m=["semester1","semester2"].some((e=>s[e].some((e=>e.average<8))));c>10&&!m?(p="pass",u="üéâ PASSED AUTOMATICALLY (General Average > 10 and no modules below 8)"):(p="fail",u=c<=10?"‚ùå CONTR√îLE REQUIRED (General Average ‚â§ 10)":"‚ùå CONTR√îLE REQUIRED (General Average > 10 but module(s) below 8)");const f=n("section"),h=n("h2",{text:`üèÜ Final Results for ${e}`});f.appendChild(h);const g=n("table"),E=n("tr");["Module","Semester","Average","Coefficient","Status"].forEach((e=>{E.appendChild(n("th",{text:e}))})),g.appendChild(E),["semester1","semester2"].forEach((e=>{s[e].forEach((t=>{const o=n("tr");o.appendChild(n("td",{text:t.name})),o.appendChild(n("td",{text:"semester1"===e?"Semester 1":"Semester 2"})),o.appendChild(n("td",{text:t.average.toFixed(2)})),o.appendChild(n("td",{text:t.coefficient.toString()})),o.appendChild(n("td",{text:"pass"===t.status?"‚úÖ PASS":"‚ùå FAIL",className:"pass"===t.status?"pass":"fail"})),g.appendChild(o)}))})),f.appendChild(g);const C=n("summary",{html:`<strong>General Average: </strong><span class="${p}">${c.toFixed(2)}/20 ‚Äî ${u}</span>`});f.appendChild(C);const x=n("p",{html:`Œ£(ModuleAvg √ó Coef) / Œ£(Coefs) = <strong>${c.toFixed(2)}/20</strong>`});f.appendChild(x),a.appendChild(f);const b=n("section",{className:"redo-section"}),A=n("h2",{text:`‚ö†Ô∏è Modules & Subjects to Redo in Contr√¥le for ${e}`});if(b.appendChild(A),c<=10||m){if(i.length>0&&i.forEach((e=>{const t=n("h3",{text:`Module: ${e.moduleName} (${e.semester})`});if(b.appendChild(t),e.subjectsBelow8.length){const t=n("ul");e.subjectsBelow8.forEach((e=>{t.appendChild(n("li",{text:e}))})),b.appendChild(t)}else{const e=n("p",{text:"All subjects passed individually but module average below 8."});b.appendChild(e)}})),c<=10&&0===i.length){const e=n("p",{text:"Contr√¥le required due to General Average ‚â§ 10, even if all modules are above 8."});b.appendChild(e)}a.appendChild(b)}return window.myUniversityGrades={generalAverage:c,semester1:s.semester1,semester2:s.semester2,passed:"pass"===p,totalModuleCoefficients:d,summary:`Your general average for ${e} is ${c.toFixed(2)}/20 ‚Äî ${u}`},a}function r(){const e=function(){const e=document.querySelectorAll(".ui-accordion-header"),t=[];return e.forEach((e=>{const n=e.textContent.match(/Ann√©e\s*:\s*(\d{4}\/\d{4})/i);if(n){const o=n[1],a=e.nextElementSibling;a&&a.classList.contains("ui-accordion-content")&&t.push({year:o,contentId:a.id})}})),t.sort(((e,t)=>t.year.localeCompare(e.year)))}();if(0===e.length)return void alert("No academic years found in the page.");const t=e[0].year,{content:o,yearSelect:r}=function(){const e=document.createElement("style");e.textContent="\n      /* Modal backdrop */\n      #gradeModalBackdrop {\n        position: fixed;\n        top: 0; left: 0; right: 0; bottom: 0;\n        background: rgba(0,0,0,0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 9999;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n      }\n      /* Modal container */\n      #gradeModal {\n        background: white;\n        max-width: 900px;\n        width: 90%;\n        max-height: 80vh;\n        overflow-y: auto;\n        border-radius: 8px;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.3);\n        padding: 20px 30px;\n        color: #222;\n        position: relative;\n      }\n      #gradeModal h1 {\n        font-size: 1.8em;\n        margin-bottom: 0.3em;\n        color: #0077cc;\n      }\n      #gradeModal h2 {\n        margin-top: 1.5em;\n        border-bottom: 2px solid #0077cc;\n        padding-bottom: 4px;\n        color: #004a99;\n      }\n      #gradeModal .closeBtn {\n        position: absolute;\n        right: 20px;\n        top: 20px;\n        font-size: 1.4em;\n        background: transparent;\n        border: none;\n        cursor: pointer;\n        color: #666;\n        transition: color 0.3s ease;\n      }\n      #gradeModal .closeBtn:hover {\n        color: #0077cc;\n      }\n      #gradeModal table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-top: 0.5em;\n      }\n      #gradeModal th, #gradeModal td {\n        padding: 8px 10px;\n        border-bottom: 1px solid #ddd;\n        text-align: left;\n        font-size: 0.95em;\n      }\n      #gradeModal th {\n        background: #f0f8ff;\n        color: #004a99;\n      }\n      #gradeModal .pass {\n        color: green;\n        font-weight: 600;\n      }\n      #gradeModal .fail {\n        color: #cc0000;\n        font-weight: 600;\n      }\n      #gradeModal .calculation {\n        font-size: 0.85em;\n        color: #555;\n        font-family: monospace;\n        margin-top: 3px;\n      }\n      #gradeModal summary {\n        font-weight: 600;\n        margin-top: 1em;\n        font-size: 1.1em;\n      }\n      #gradeModal .redo-section {\n        margin-top: 2em;\n        border-top: 2px dashed #cc0000;\n        padding-top: 1em;\n      }\n      #gradeModal .redo-section h3 {\n        color: #cc0000;\n      }\n      #gradeModal ul {\n        margin-left: 1.2em;\n      }\n      #gradeModal ul li {\n        margin-bottom: 0.3em;\n      }\n      #gradeModal .year-selection {\n        margin-bottom: 1em;\n      }\n      #gradeModal .year-selection select {\n        padding: 8px;\n        font-size: 1em;\n        border-radius: 4px;\n        border: 1px solid #ccc;\n        margin-left: 10px;\n        cursor: pointer;\n      }\n    ",document.head.appendChild(e);const t=document.createElement("div");t.id="gradeModalBackdrop";const n=document.createElement("div");n.id="gradeModal",n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.setAttribute("aria-labelledby","gradeModalTitle");const o=document.createElement("button");o.className="closeBtn",o.innerHTML="√ó",o.title="Close results",o.addEventListener("click",(()=>{t.remove(),e.remove()})),n.appendChild(o);const a=document.createElement("h1");a.id="gradeModalTitle",a.textContent="Tekup Grade Calculation",n.appendChild(a);const r=document.createElement("div");r.className="year-selection",r.innerHTML='\n      <label for="yearSelect">Select Academic Year: </label>\n      <select id="yearSelect"></select>\n    ',n.appendChild(r);const s=document.createElement("div");return s.id="gradeModalContent",n.appendChild(s),t.appendChild(n),document.body.appendChild(t),{content:s,yearSelect:r.querySelector("#yearSelect")}}();e.forEach((({year:e})=>{const n=document.createElement("option");n.value=e,n.textContent=e,e===t&&(n.selected=!0),r.appendChild(n)}));const s=n(t,e),l=a(t,s);o.appendChild(l),r.addEventListener("change",(()=>{const t=r.value;o.innerHTML="";const s=a(t,n(t,e));o.appendChild(s)}))}"complete"===document.readyState||"interactive"===document.readyState?r():document.addEventListener("DOMContentLoaded",r)}();